<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medi point Quotation</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0ea5e9">
    <link rel="apple-touch-icon" href="img/icon-192.png">

    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: '#008542', // Your Brand Blue
                        brandLight: '#e6e7ff', // Your Light Background
                        brandDark: '#008542',
                    },
                    fontFamily: {
                        sans: ['Hind Siliguri', 'Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Hind Siliguri', sans-serif;
            color: #008542;
            background-color: #f3f4f6;
        }
        /* A4 Paper Settings */
        
        @page {
            size: A4;
            margin: 0;
        }
        
        .page-sheet {
            width: 210mm;
            min-height: 297mm;
            /* Exact A4 height */
            background: white;
            margin: 20px auto;
            padding: 10mm 12mm;
            position: relative;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            /* FLEX LAYOUT: Keeps footer at bottom, prevents overlap */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        /* Watermark */
        
        .watermark-background {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60%;
            height: 60%;
            background-image: url('surgi.png');
            /* Ensure this image exists */
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
            opacity: 0.10;
            z-index: 0;
            pointer-events: none;
        }
        
        .content-layer {
            position: relative;
            z-index: 10;
            flex-grow: 1;
            /* Pushes footer down */
        }
        /* Dotted Input Style */
        
        .dotted {
            border-bottom: 2px dotted #4ac487;
            outline: none;
            background: transparent;
            width: 100%;
            color: #000;
            font-weight: 600;
        }
        
        textarea {
            resize: none;
            background: transparent;
            outline: none;
            width: 100%;
        }
        /* Upload Zone */
        
        .upload-zone {
            transition: all 0.2s;
            border: 2px dashed #cbd5e1;
        }
        
        .upload-zone:hover {
            border-color: #008542;
            background-color: #e6e7ff;
        }
        /* Print Specifics */
        
        @media print {
            body {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                background: white;
            }
            .no-print {
                display: none !important;
            }
            .page-sheet {
                box-shadow: none !important;
                margin: 0 !important;
                width: 210mm !important;
                height: 297mm !important;
                padding: 10mm 12mm !important;
            }
            input,
            textarea {
                border: none !important;
                border-bottom: none !important;
                padding: 0 !important;
                margin: 0 !important;
            }
            .dotted {
                border-bottom: none !important;
            }
            /* Removing absolute position to prevent overlap */
            #footer-section {
                position: relative !important;
                margin-top: auto;
            }
            /* Hide Delete Buttons in Print */
            .delete-col {
                display: none;
            }
        }
    </style>
</head>

<body class="bg-gray-100">

    <div class="no-print fixed top-5 right-5 z-50 flex flex-col gap-2">
        <button onclick="window.print()" class="bg-brand text-white px-6 py-2 rounded-full font-bold shadow-lg hover:bg-blue-800 transition flex items-center justify-center gap-2">
        üñ®Ô∏è Print Quotation
        </button>
        <button onclick="addRow()" class="bg-white text-brand border border-brand px-6 py-2 rounded-full font-bold shadow-lg hover:bg-brandLight transition flex items-center justify-center gap-2">
            ‚ûï Add Row
        </button>
    </div>

    <div class="page-sheet">
        <div class="watermark-background"></div>

        <div class="content-layer">

            <header class="relative mb-6">
                <div class="flex justify-center mb-2">
                    <div class="bg-brand text-white px-8 py-1 font-bold text-xl rounded-sm tracking-widest uppercase">Quotation</div>
                </div>

                <div class="flex flex-col items-center relative">
                    <div class="absolute left-0 top-0 w-24 md:w-28">
                        <img src="surgi.png" alt="Logo" class="w-full">
                    </div>

                    <div class="text-center w-full pl-20 pr-4">
                        <h1 class="text-3xl font-bold text-brand leading-none mb-1">‡¶Æ‡ßá‡¶°‡¶ø ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶∞‡ßç‡¶ú‡¶ø‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡¶ø‡¶Ç ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶∞</h1>
                        <h2 class="text-2xl font-bold text-brand uppercase tracking-wide">MEDI POINT SURGICAL SERVICING CENTER</h2>
                        <p class="text-sm font-semibold text-brand">(Medical Equipement System)</p>
                        <p class="text-lg font-medium mt-1">‡¶¨‡ßá‡ßú‡¶ø‡¶¨‡¶æ‡¶Å‡¶ß ‡¶∞‡ßã‡¶°, ‡¶¨‡ßã‡¶ü ‡¶ò‡¶æ‡¶ü, ‡¶ï‡¶æ‡¶ü‡¶æ‡¶∏‡ßÅ‡¶∞, ‡¶Æ‡ßã‡¶π‡¶æ‡¶Æ‡ßç‡¶Æ‡¶¶‡¶™‡ßÅ‡¶∞, ‡¶¢‡¶æ‡¶ï‡¶æ-1207</p>

                        <div class="flex justify-center items-center gap-2 text-sm font-bold mt-1 flex-wrap">
                            <span class="flex items-center gap-1">
                                <span class="bg-pink-600 text-white px-1 text-xs rounded">bkash</span>
                            <span class="bg-orange-500 text-white px-1 text-xs rounded">Nagad</span>
                            <span>01726-029655,01688-137772</span>
                            </span>
                        </div>
                        <div class="text-xs mt-1 font-medium">
                            E-mail: medipoint655@gmail.com
                        </div>
                    </div>
                </div>
            </header>

            <div class="flex justify-between items-end mb-2">
                <div class="flex w-1/2 items-end">
                    <span class="font-bold whitespace-nowrap mr-2 text-brand">Ref No:</span>
                    <input type="text" value="STC-2026/001" class="dotted text-left">
                </div>
                <div class="flex w-1/3 items-end justify-end">
                    <span class="font-bold whitespace-nowrap mr-2 text-brand">Date:</span>
                    <input type="text" id="date-box" class="dotted text-right">
                </div>
            </div>

            <div class="mb-6 space-y-2">
                <div class="flex items-end">
                    <span class="font-bold whitespace-nowrap mr-2 text-brand w-20">Customer:</span>
                    <input type="text" class="dotted" placeholder="Hospital / Client Name">
                </div>
                <div class="flex items-end">
                    <span class="font-bold whitespace-nowrap mr-2 text-brand w-20">Address:</span>
                    <input type="text" class="dotted" placeholder="Client Address">
                </div>
            </div>

            <table class="w-full border-2 border-brand text-sm mb-4">
                <thead>
                    <tr class="bg-brandLight text-brand text-center font-bold border-b-2 border-brand">
                        <th class="border-r-2 border-brand p-2 w-[5%]">SL</th>
                        <th class="border-r-2 border-brand p-2 w-[40%]">Description & Specification</th>
                        <th class="border-r-2 border-brand p-2 w-[25%]">Image</th>
                        <th class="border-r-2 border-brand p-2 w-[15%]">Rate</th>
                        <th class="p-2 w-[15%]">Amount</th>
                        <th class="p-1 w-[5%] no-print delete-col bg-white border-l-2 border-brand">Del</th>
                    </tr>
                </thead>
                <tbody id="invoice-body">
                </tbody>
            </table>

            <div class="flex justify-end mt-0">
                <div class="w-[40%] flex border-2 border-t-0 border-brand">
                    <div class="w-1/2 p-1 font-bold text-center border-r-2 border-brand bg-brandLight">Total</div>
                    <div class="w-1/2 p-1 text-right font-bold pr-2"><span id="grand-total">0.00</span></div>
                </div>
            </div>
        </div>

        <div id="footer-section" class="pb-0 mt-10">
            <div class="mb-12 px-10">
                <div class="flex items-end">
                    <span class="font-bold whitespace-nowrap mr-2">In Words:</span>
                    <span id="words-output" class="dotted italic text-black font-medium">Zero Taka Only</span>
                </div>
            </div>

            <div class="flex justify-between px-4 mb-6 font-bold text-lg">
                <div class="text-center">
                    <div class="border-t-2 border-brand w-40 pt-1 text-brand">Received By</div>
                </div>
                <div class="text-center">
                    <div class="border-t-2 border-brand w-40 pt-1 text-brand">Authorized Signature</div>
                </div>
            </div>

            <div class="bg-brand text-white text-center py-2 text-sm font-medium">
                Note: This quotation is valid for 15 days from the date of issue.
            </div>
        </div>
    </div>

    <script>
        // Set Date
        const dateObj = new Date();
        const options = {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        };
        document.getElementById('date-box').value = dateObj.toLocaleDateString('en-GB', options);

        // Initialize
        window.onload = function() {
            renderRows(3); // Start with 3 rows
        };

        function addRow() {
            renderRows(1);
        }

        function renderRows(count) {
            const tbody = document.getElementById('invoice-body');
            for (let i = 0; i < count; i++) {
                const tr = document.createElement('tr');
                const uniqueId = Date.now() + Math.random().toString(36).substr(2, 9);
                tr.className = "border-b border-brand border-opacity-30 valign-top";

                tr.innerHTML = `
                    <td class="border-r-2 border-brand p-2 text-center align-top font-bold index-cell"></td>
                    
                    <td class="border-r-2 border-brand p-2 align-top">
                        <textarea class="w-full text-sm font-medium placeholder-gray-400" rows="3" 
                        placeholder="Item Name\n- Spec 1\n- Spec 2" oninput="autoResize(this)"></textarea>
                    </td>

                    <td class="border-r-2 border-brand p-1 align-middle">
                        <div class="relative w-full h-full min-h-[80px] flex items-center justify-center">
                            <input type="file" id="file-${uniqueId}" accept="image/*" class="hidden" onchange="previewImage(this, 'img-${uniqueId}')">
                            <label for="file-${uniqueId}" class="upload-zone no-print w-full h-20 flex flex-col items-center justify-center cursor-pointer rounded bg-gray-50 text-gray-400 hover:text-brand" id="label-img-${uniqueId}">
                                <span class="text-[10px] uppercase font-bold">Add Photo</span>
                            </label>
                            <div class="relative w-full">
                                <img id="img-${uniqueId}" src="" class="hidden w-full max-h-[100px] object-contain">
                                <button onclick="removeImage('img-${uniqueId}')" class="no-print hidden absolute top-0 right-0 bg-red-500 text-white rounded-full p-0.5 w-5 h-5 flex items-center justify-center shadow hover:bg-red-600" id="btn-img-${uniqueId}">√ó</button>
                            </div>
                        </div>
                    </td>

                    <td class="border-r-2 border-brand p-2 align-top">
                        <input type="number" class="w-full text-right font-bold outline-none bg-transparent rate-input" placeholder="0.00" oninput="calcTotal()">
                    </td>
                    
                    <td class="p-2 align-top text-right font-bold text-brand">
                        <span class="row-total">0.00</span>
                    </td>

                    <td class="no-print align-middle text-center p-1 border-l-2 border-brand delete-col">
                         <button onclick="deleteRow(this)" class="bg-red-100 hover:bg-red-500 hover:text-white text-red-500 rounded p-1 transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                         </button>
                    </td>
                `;
                tbody.appendChild(tr);
                reIndex();
            }
        }

        function deleteRow(btn) {
            btn.closest('tr').remove();
            reIndex();
            calcTotal();
        }

        function reIndex() {
            document.querySelectorAll('.index-cell').forEach((cell, index) => {
                cell.innerText = index + 1;
            });
        }

        function autoResize(el) {
            el.style.height = 'auto';
            el.style.height = el.scrollHeight + 'px';
        }

        function previewImage(input, imgId) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById(imgId).src = e.target.result;
                    document.getElementById(imgId).classList.remove('hidden');
                    document.getElementById('label-' + imgId).classList.add('hidden');
                    document.getElementById('btn-' + imgId).classList.remove('hidden');
                }
                reader.readAsDataURL(file);
            }
        }

        function removeImage(imgId) {
            document.getElementById(imgId).src = '';
            document.getElementById(imgId).classList.add('hidden');
            document.getElementById('label-' + imgId).classList.remove('hidden');
            document.getElementById('btn-' + imgId).classList.add('hidden');
        }

        function calcTotal() {
            let grandTotal = 0;
            document.querySelectorAll('tbody tr').forEach(row => {
                const rate = parseFloat(row.querySelector('.rate-input').value) || 0;
                const total = rate; // Assuming Qty 1

                row.querySelector('.row-total').innerText = total > 0 ? total.toFixed(2) : '0.00';
                grandTotal += total;
            });

            document.getElementById('grand-total').innerText = grandTotal.toFixed(2);
            document.getElementById('words-output').innerText = inWords(Math.round(grandTotal)) + " Taka Only";
        }

        function inWords(num) {
            if (num === 0) return "Zero";
            const a = ['', 'One ', 'Two ', 'Three ', 'Four ', 'Five ', 'Six ', 'Seven ', 'Eight ', 'Nine ', 'Ten ', 'Eleven ', 'Twelve ', 'Thirteen ', 'Fourteen ', 'Fifteen ', 'Sixteen ', 'Seventeen ', 'Eighteen ', 'Nineteen '];
            const b = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];

            const n = ('000000000' + num).substr(-9).match(/^(\d{2})(\d{2})(\d{2})(\d{1})(\d{2})$/);
            if (!n) return;

            let str = '';
            str += (n[1] != 0) ? (a[Number(n[1])] || b[n[1][0]] + ' ' + a[n[1][1]]) + 'Crore ' : '';
            str += (n[2] != 0) ? (a[Number(n[2])] || b[n[2][0]] + ' ' + a[n[2][1]]) + 'Lakh ' : '';
            str += (n[3] != 0) ? (a[Number(n[3])] || b[n[3][0]] + ' ' + a[n[3][1]]) + 'Thousand ' : '';
            str += (n[4] != 0) ? (a[Number(n[4])] || b[n[4][0]] + ' ' + a[n[4][1]]) + 'Hundred ' : '';
            str += (n[5] != 0) ? ((str != '') ? 'and ' : '') + (a[Number(n[5])] || b[n[5][0]] + ' ' + a[n[5][1]]) : '';

            return str.trim();
        }
    </script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(reg => console.log('SW Registered!', reg.scope))
                    .catch(err => console.log('SW Failed:', err));
            });
        }
    </script>
</body>

</html>